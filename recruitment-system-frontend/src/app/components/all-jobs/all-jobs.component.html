<div class="container mx-auto p-8 pt-20">
  <h2 class="text-3xl font-bold text-gray-800 dark:text-white mb-6">All Jobs</h2>
  <div *ngIf="isLoading" class="flex justify-center items-center p-4">
    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
    <span class="ml-2">Loading jobs...</span>
  </div>
  <div *ngIf="errorMessage" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4"
    role="alert">
    <strong class="font-bold">Error!</strong>
    <span class="block sm:inline">{{ errorMessage }}</span>
  </div>
  <div *ngIf="!isLoading && jobs.length === 0 && !errorMessage"
    class="bg-blue-100 border-t border-b border-blue-500 text-blue-700 px-4 py-3 mb-4" role="alert">
    <p class="font-bold">No Jobs Found</p>
    <p class="text-sm">There are no jobs available at the moment.</p>
  </div>
  <div *ngIf="!isLoading && jobs.length > 0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
    <div *ngFor="let job of jobs"
      class="bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6 flex flex-col h-full hover:shadow-xl transition-shadow duration-300">
      <h3 class="text-xl font-bold text-gray-900 dark:text-white">{{ job.title }}</h3>
      <p class="text-sm text-blue-600 dark:text-blue-400 mb-2">{{ job.company_name }}</p>
      <p class="text-gray-600 dark:text-gray-300 text-sm line-clamp-4 flex-grow">{{ job.description }}</p>
      <div class="mt-auto pt-4">
        <div class="text-gray-800 dark:text-gray-100 font-semibold text-lg mb-4">
          <span *ngIf="job.min_salary && job.max_salary">${{ job.min_salary | number }} - ${{ job.max_salary |
            number }}</span>
          <span *ngIf="!job.min_salary && !job.max_salary">Salary not specified</span>
        </div>
        <div class="space-y-2">
          <a [routerLink]="['/jobs', job.id]"
            class="block w-full text-center bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">View
            Details</a>
          <button *ngIf="canApply(job.id)" (click)="openApplyModal(job)"
            class="block w-full text-center bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">Apply</button>
        </div>
        <div class="text-sm text-center text-gray-500 dark:text-gray-400 mt-4">
          Posted: {{ job.created_at | date:'mediumDate' }}
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div *ngIf="showApplyModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-lg p-8 w-full max-w-md relative text-gray-900">
      <button (click)="closeApplyModal()"
        class="absolute top-2 right-2 text-gray-500 hover:text-gray-700">&times;</button>
      <h3 class="text-xl font-bold mb-4">Apply for {{ selectedJob?.title }}</h3>
      <form (ngSubmit)="submitApplication()" autocomplete="off">
        <div class="mb-4">
          <label class="block text-gray-900 font-bold mb-2">CV File (PDF, DOC, DOCX):</label>
          <input type="file" accept=".pdf,.doc,.docx" (change)="onCvSelected($event)" class="w-full border rounded p-2"
            required />
        </div>
        <div class="mb-4">
          <label class="block text-gray-900 font-bold mb-2">Cover Letter (optional):</label>
          <textarea [(ngModel)]="coverLetter" name="coverLetter" rows="4"
            class="w-full border rounded p-2 text-gray-900"></textarea>
        </div>
        <div *ngIf="applyError" class="bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded mb-2">{{
          applyError }}</div>
        <div *ngIf="applySuccess" class="bg-green-100 border border-green-400 text-green-700 px-4 py-2 rounded mb-2">{{
          applySuccess
          }}</div>
        <button type="submit" [disabled]="isApplying"
          class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded w-full">Submit
          Application</button>
      </form>
    </div>
  </div>
</div>