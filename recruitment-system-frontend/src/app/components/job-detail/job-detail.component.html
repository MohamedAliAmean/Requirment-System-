<div class="min-h-screen bg-gray-100 p-6">
  <div *ngIf="job" class="bg-white rounded-lg shadow-xl overflow-hidden max-w-4xl mx-auto p-8">
    <h1 class="text-4xl font-extrabold text-gray-900 mb-4">{{ job.title }}</h1>
    <p class="text-indigo-600 font-semibold text-xl mb-6">{{ job.company_name }}</p>

    <div class="mb-8">
      <h2 class="text-2xl font-bold text-gray-800 mb-3">Job Description</h2>
      <p class="text-gray-700 leading-relaxed">{{ job.description }}</p>
    </div>

    <div class="mb-8">
      <h2 class="text-2xl font-bold text-gray-800 mb-3">Requirements</h2>
      <p class="text-gray-700 leading-relaxed">{{ job.requirements }}</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-600 text-lg mb-8">
      <div>
        <p class="font-medium">Applicants:</p>
        <p>{{ job.number_of_applicants }}</p>
      </div>
      <div>
        <p class="font-medium">Status:</p>
        <p [class.text-green-600]="job.status === 'active'" [class.text-red-600]="job.status === 'closed'">{{ job.status
          | titlecase }}</p>
      </div>
      <div>
        <p class="font-medium">Posted On:</p>
        <p>{{ job.created_at | date:'mediumDate' }}</p>
      </div>
    </div>

    <div *ngIf="isLoggedIn && isApplicant && job.status === 'active'"
      class="mt-8 p-6 bg-gray-50 rounded-lg shadow-inner">
      <h2 class="text-2xl font-bold text-gray-800 mb-4">Apply for this Job</h2>

      <div *ngIf="applicationSuccessMessage"
        class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
        <span class="block sm:inline">{{ applicationSuccessMessage }}</span>
      </div>
      <div *ngIf="applicationErrorMessage"
        class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
        <span class="block sm:inline" [innerHTML]="applicationErrorMessage"></span>
      </div>

      <form [formGroup]="applicationForm" (ngSubmit)="onApplySubmit()" class="space-y-4">
        <div>
          <label for="cv_file" class="block text-sm font-medium text-gray-700">Upload CV (PDF, DOC, DOCX)</label>
          <input type="file" id="cv_file" (change)="onFileSelected($event)"
            class="mt-1 block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-white focus:outline-none">
          <div
            *ngIf="applicationForm.get('cv_file')?.invalid && (applicationForm.get('cv_file')?.dirty || applicationForm.get('cv_file')?.touched)"
            class="text-red-500 text-xs mt-1">
            <div *ngIf="applicationForm.get('cv_file')?.errors?.['required']">CV file is required.</div>
          </div>
        </div>

        <div>
          <label for="cover_letter" class="block text-sm font-medium text-gray-700">Cover Letter (Optional)</label>
          <textarea id="cover_letter" formControlName="cover_letter" rows="5"
            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900"></textarea>
        </div>

        <button type="submit"
          class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
          Submit Application
        </button>
      </form>
    </div>

    <div *ngIf="!isLoggedIn" class="mt-8 text-center text-gray-600 text-lg">
      <p>Please <a routerLink="/login" class="text-indigo-600 hover:underline">login</a> or <a routerLink="/register"
          class="text-indigo-600 hover:underline">register</a> as a Job Applicant to apply for this job.</p>
    </div>

    <div *ngIf="isLoggedIn && !isApplicant" class="mt-8 text-center text-gray-600 text-lg">
      <p>Only Job Applicants can apply for jobs.</p>
    </div>

    <div *ngIf="job.status === 'closed' && isLoggedIn && isApplicant" class="mt-8 text-center text-red-600 text-lg">
      <p>This job is currently closed for applications.</p>
    </div>
  </div>

  <div *ngIf="errorMessage"
    class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mt-6 max-w-4xl mx-auto"
    role="alert">
    <p>{{ errorMessage }}</p>
  </div>

  <div *ngIf="!job && !errorMessage" class="text-center text-gray-600 text-lg mt-6">
    <p>Loading job details...</p>
  </div>
</div>